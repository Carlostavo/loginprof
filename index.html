<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galería Drive - Carga Ultra Rápida</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e6e6e6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            color: #3ECF8E;
            font-size: 2.8rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        .subtitle {
            color: #a3b1c6;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .optimization-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .optimization-info h2 {
            color: #4cc9f0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .optimization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .optimization-card {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3ECF8E;
        }
        
        .optimization-card h3 {
            color: #3ECF8E;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            background: linear-gradient(135deg, #3ECF8E, #2a9d8f);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(62, 207, 142, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(62, 207, 142, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #EA4335, #f4a261);
            margin-left: 10px;
        }
        
        .btn-small {
            padding: 10px 20px;
            font-size: 0.9rem;
        }
        
        .gallery-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .gallery-title {
            font-size: 1.8rem;
            color: #4cc9f0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .performance-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .image-counter {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            color: #a3b1c6;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .load-time {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .gallery {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 25px;
            gap: 25px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            cursor: grab;
            min-height: 350px;
            align-items: center;
            scrollbar-width: thin;
            scrollbar-color: #3ECF8E #2a2a3e;
            margin-bottom: 30px;
        }
        
        .gallery::-webkit-scrollbar {
            height: 12px;
        }
        
        .gallery::-webkit-scrollbar-track {
            background: #2a2a3e;
            border-radius: 10px;
        }
        
        .gallery::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3ECF8E, #4cc9f0);
            border-radius: 10px;
        }
        
        .gallery:active {
            cursor: grabbing;
        }
        
        .gallery-item {
            flex: 0 0 auto;
            width: 380px;
            height: 280px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .gallery-item:hover {
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            z-index: 10;
            border-color: #3ECF8E;
        }
        
        .gallery-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
            background: linear-gradient(45deg, #2a2a3e, #1a1a2e);
        }
        
        .gallery-item:hover .gallery-img {
            transform: scale(1.15);
        }
        
        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            color: white;
            padding: 25px;
            opacity: 1;
        }
        
        .gallery-overlay h3 {
            font-size: 1.4rem;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .gallery-overlay p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #4cc9f0;
            border: 2px solid #4cc9f0;
            border-radius: 50%;
            width: 65px;
            height: 65px;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .control-btn:hover {
            background: #4cc9f0;
            color: #1a1a2e;
            transform: scale(1.15);
            border-color: #4cc9f0;
        }
        
        .auto-play-toggle {
            background: linear-gradient(135deg, #3ECF8E, #4cc9f0);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 15px 40px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(62, 207, 142, 0.3);
        }
        
        .auto-play-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(62, 207, 142, 0.4);
        }
        
        .auto-play-toggle.active {
            background: linear-gradient(135deg, #EA4335, #f4a261);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 60px;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.1);
            border-top: 6px solid #3ECF8E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3ECF8E, #4cc9f0);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .success-message {
            background: rgba(76, 175, 80, 0.1);
            color: #3ECF8E;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #3ECF8E;
            display: none;
        }
        
        footer {
            text-align: center;
            color: #a3b1c6;
            margin-top: 40px;
            padding: 20px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .gallery-item {
                width: 320px;
                height: 240px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .gallery-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
                margin-bottom: 10px;
            }
            
            .btn-secondary {
                margin-left: 0;
            }
            
            .optimization-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-bolt"></i>
                Galería Drive - Carga Ultra Rápida
            </h1>
            <p class="subtitle">Optimización avanzada para carga instantánea • Pre-caching • Lazy loading</p>
        </header>
        
        <div class="optimization-info">
            <h2><i class="fas fa-tachometer-alt"></i> Optimizaciones de Velocidad</h2>
            
            <div class="optimization-grid">
                <div class="optimization-card">
                    <h3><i class="fas fa-rocket"></i> Pre-caching</h3>
                    <p>Las imágenes se cargan en segundo plano antes de mostrarse</p>
                </div>
                
                <div class="optimization-card">
                    <h3><i class="fas fa-layer-group"></i> Lazy Loading</h3>
                    <p>Solo se cargan las imágenes visibles en pantalla</p>
                </div>
                
                <div class="optimization-card">
                    <h3><i class="fas fa-compress-arrows-alt"></i> Compresión</h3>
                    <p>Usa thumbnails pequeños y comprimidos</p>
                </div>
                
                <div class="optimization-card">
                    <h3><i class="fas fa-sync-alt"></i> Carga Progresiva</h3>
                    <p>Muestra imágenes a medida que se cargan</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" id="loadFastBtn">
                    <i class="fas fa-bolt"></i> Carga Rápida (Recomendado)
                </button>
                <button class="btn btn-secondary" id="loadNormalBtn">
                    <i class="fas fa-image"></i> Carga Normal
                </button>
                <button class="btn btn-small" id="preloadBtn" style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); margin-left: 10px;">
                    <i class="fas fa-forward"></i> Pre-cargar Todo
                </button>
            </div>
            
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="success-message" id="successMessage"></div>
        </div>
        
        <div class="gallery-container">
            <div class="gallery-header">
                <h2 class="gallery-title"><i class="fas fa-images"></i> Galería de Imágenes</h2>
                <div class="performance-info">
                    <div class="image-counter" id="imageCounter">0 imágenes</div>
                    <div class="load-time" id="loadTime">Tiempo: 0s</div>
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Optimizando carga de imágenes...</p>
            </div>
            
            <div class="gallery" id="imageGallery">
                <!-- Las imágenes se cargarán aquí -->
            </div>
            
            <div class="controls">
                <button class="control-btn" id="prevBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                
                <button class="auto-play-toggle" id="autoPlayToggle">
                    <i class="fas fa-play"></i> Iniciar Auto-Desplazamiento
                </button>
                
                <button class="control-btn" id="nextBtn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <footer>
            <p>Galería optimizada para velocidad • Carga instantánea • Desplazamiento suave</p>
            <p style="margin-top: 10px; font-size: 0.8rem; color: #6c757d;">
                Usa "Carga Rápida" para la mejor experiencia de usuario
            </p>
        </footer>
    </div>

    <script>
        // IDs de imágenes con múltiples tamaños disponibles
        const IMAGE_DATA = [
            { id: '1PEGJbSS4s5AlXg9BeQORgIF7s1bEn-DO', name: 'Imagen 1' },
            { id: '1Ob_s_u7935yFl7ryFCPmEauLw7u6ICJJ', name: 'Imagen 2' },
            { id: '1lgicS6s6bQzYQklmxGFhIrSHM6iwzbiw', name: 'Imagen 3' },
            { id: '16WBqPyC5axmwuNhZmK-J-ONqvZmv4Uuv', name: 'Imagen 4' },
            { id: '1frO2hh-tvzWmhMAcgA3VRrxWDRdlvWUt', name: 'Imagen 5' },
            { id: '1KqKR8UV0oZZdh4UNpzfyIQ3AD7wJ_gXL', name: 'Imagen 6' },
            { id: '17U1TKUYAkihDywkHTENwd6b70daMWxTe', name: 'Imagen 7' },
            { id: '1FBYe8BgbZvX22sYD6trufBVTwsNhYLs0', name: 'Imagen 8' },
            { id: '1Gz3qPGrUhgihd7EBxjVd2DkgKflh-aoj', name: 'Imagen 9' },
            { id: '1GcwLzuHhiyg6WGL2xorDMCCqM3MQ75iE', name: 'Imagen 10' }
        ];
        
        // Variables globales
        let autoPlayInterval;
        let isAutoPlaying = false;
        let scrollSpeed = 4000;
        let galleryItems = [];
        let imageCache = new Map(); // Cache para imágenes pre-cargadas
        let startTime;
        let loadedImages = 0;
        let totalImages = 0;
        
        // Referencias a elementos DOM
        const gallery = document.getElementById('imageGallery');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const successMessage = document.getElementById('successMessage');
        const imageCounter = document.getElementById('imageCounter');
        const loadTime = document.getElementById('loadTime');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const autoPlayToggle = document.getElementById('autoPlayToggle');
        const loadFastBtn = document.getElementById('loadFastBtn');
        const loadNormalBtn = document.getElementById('loadNormalBtn');
        const preloadBtn = document.getElementById('preloadBtn');
        
        // ESTRATEGIA 1: Carga Rápida con optimizaciones
        async function loadFastGallery() {
            startTime = performance.now();
            showLoading(true);
            progressBar.style.display = 'block';
            clearMessages();
            
            try {
                // Limpiar galería
                gallery.innerHTML = '';
                galleryItems = [];
                loadedImages = 0;
                totalImages = IMAGE_DATA.length;
                
                // 1. Crear elementos de galería inmediatamente (sin imágenes)
                IMAGE_DATA.forEach((img, index) => {
                    createGallerySkeleton(img.id, img.name, index + 1);
                });
                
                updateImageCounter();
                
                // 2. Cargar imágenes en paralelo con lazy loading
                await loadImagesWithLazyLoading();
                
                // 3. Mostrar tiempo de carga
                const endTime = performance.now();
                const loadDuration = ((endTime - startTime) / 1000).toFixed(2);
                loadTime.textContent = `Carga: ${loadDuration}s`;
                
                showSuccess(`✓ ${totalImages} imágenes cargadas en ${loadDuration} segundos`);
                
                // 4. Iniciar auto-play
                if (totalImages > 1 && !isAutoPlaying) {
                    startAutoPlay();
                    autoPlayToggle.classList.add('active');
                    autoPlayToggle.innerHTML = '<i class="fas fa-pause"></i> Detener Auto-Desplazamiento';
                    isAutoPlaying = true;
                }
                
            } catch (error) {
                console.error('Error en carga rápida:', error);
            } finally {
                showLoading(false);
                progressBar.style.display = 'none';
            }
        }
        
        // Crear esqueleto de galería (sin imágenes)
        function createGallerySkeleton(imageId, imageName, number) {
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item';
            galleryItem.dataset.id = imageId;
            galleryItem.dataset.loaded = 'false';
            
            galleryItem.innerHTML = `
                <div class="gallery-item-content">
                    <div class="image-container" style="width: 100%; height: 100%; position: relative; background: linear-gradient(45deg, #2a2a3e, #1a1a2e);">
                        <!-- Placeholder mientras carga -->
                        <div class="image-placeholder" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                            <div class="placeholder-spinner" style="width: 40px; height: 40px; border: 3px solid rgba(62, 207, 142, 0.3); border-top-color: #3ECF8E; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                        <!-- Imagen real (oculta inicialmente) -->
                        <img class="gallery-img lazy-image" 
                             style="display: none;"
                             data-id="${imageId}"
                             alt="${imageName}">
                    </div>
                    
                    <div class="gallery-overlay">
                        <h3>${imageName}</h3>
                        <p>Cargando...</p>
                    </div>
                </div>
            `;
            
            gallery.appendChild(galleryItem);
            galleryItems.push({ id: imageId, element: galleryItem });
        }
        
        // Cargar imágenes con lazy loading
        async function loadImagesWithLazyLoading() {
            const promises = [];
            
            // Primero: Cargar imágenes visibles inmediatamente
            const visibleItems = getVisibleGalleryItems();
            
            for (const item of visibleItems) {
                promises.push(loadSingleImage(item.id, item.element, true));
            }
            
            await Promise.all(promises);
            
            // Luego: Observar elementos para lazy loading
            setupIntersectionObserver();
            
            // Finalmente: Pre-cargar el resto en segundo plano
            preloadRemainingImages();
        }
        
        // Obtener elementos visibles en la galería
        function getVisibleGalleryItems() {
            const galleryRect = gallery.getBoundingClientRect();
            const visibleItems = [];
            
            galleryItems.forEach(item => {
                const itemRect = item.element.getBoundingClientRect();
                if (itemRect.left < galleryRect.right && itemRect.right > galleryRect.left) {
                    visibleItems.push(item);
                }
            });
            
            return visibleItems;
        }
        
        // Configurar Intersection Observer para lazy loading
        function setupIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const item = entry.target;
                        const imageId = item.dataset.id;
                        const imgElement = item.querySelector('.lazy-image');
                        
                        if (!item.dataset.loaded || item.dataset.loaded === 'false') {
                            loadSingleImage(imageId, item, false);
                        }
                        
                        observer.unobserve(item);
                    }
                });
            }, {
                root: gallery,
                rootMargin: '100px',
                threshold: 0.1
            });
            
            // Observar todos los elementos de la galería
            galleryItems.forEach(item => {
                observer.observe(item.element);
            });
        }
        
        // Cargar una sola imagen
        async function loadSingleImage(imageId, galleryItem, isPriority) {
            try {
                // Verificar si ya está en cache
                if (imageCache.has(imageId)) {
                    updateGalleryImage(galleryItem, imageCache.get(imageId), imageId);
                    return;
                }
                
                // Usar diferentes tamaños según prioridad
                const size = isPriority ? 'w400' : 'w200'; // Más pequeño para lazy loading
                const imageUrl = `https://drive.google.com/thumbnail?id=${imageId}&sz=${size}`;
                
                // Crear promesa con timeout
                const imagePromise = new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => {
                        // Guardar en cache
                        imageCache.set(imageId, img.src);
                        resolve(img.src);
                    };
                    img.onerror = reject;
                    img.src = imageUrl;
                });
                
                // Timeout de 5 segundos
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('Timeout')), 5000);
                });
                
                const imageSrc = await Promise.race([imagePromise, timeoutPromise]);
                updateGalleryImage(galleryItem, imageSrc, imageId);
                
            } catch (error) {
                console.warn(`Error cargando imagen ${imageId}:`, error);
                // Usar placeholder en caso de error
                updateGalleryImage(galleryItem, 
                    `https://via.placeholder.com/380x280/2a2a3e/3ECF8E?text=Imagen+${galleryItem.dataset.number}`, 
                    imageId);
            }
        }
        
        // Actualizar imagen en la galería
        function updateGalleryImage(galleryItem, imageSrc, imageId) {
            const imgElement = galleryItem.querySelector('.lazy-image');
            const placeholder = galleryItem.querySelector('.image-placeholder');
            const overlayText = galleryItem.querySelector('.gallery-overlay p');
            
            if (imgElement && placeholder) {
                // Mostrar imagen
                imgElement.src = imageSrc;
                imgElement.style.display = 'block';
                placeholder.style.display = 'none';
                
                // Marcar como cargada
                galleryItem.dataset.loaded = 'true';
                
                // Actualizar overlay
                if (overlayText) {
                    overlayText.textContent = `ID: ${imageId.substring(0, 10)}...`;
                }
                
                // Actualizar progreso
                loadedImages++;
                const progress = (loadedImages / totalImages) * 100;
                progressFill.style.width = `${progress}%`;
            }
        }
        
        // Pre-cargar imágenes restantes en segundo plano
        async function preloadRemainingImages() {
            const uncachedImages = IMAGE_DATA.filter(img => !imageCache.has(img.id));
            
            if (uncachedImages.length === 0) return;
            
            // Usar tamaño pequeño para pre-carga
            const preloadPromises = uncachedImages.map(img => {
                return new Promise((resolve) => {
                    const preloadImg = new Image();
                    preloadImg.onload = () => {
                        imageCache.set(img.id, preloadImg.src);
                        resolve();
                    };
                    preloadImg.onerror = resolve; // Ignorar errores en pre-carga
                    preloadImg.src = `https://drive.google.com/thumbnail?id=${img.id}&sz=w100`;
                });
            });
            
            // Ejecutar en segundo plano sin esperar
            Promise.allSettled(preloadPromises).then(() => {
                console.log('Pre-carga completada');
            });
        }
        
        // ESTRATEGIA 2: Pre-cargar todas las imágenes
        async function preloadAllImages() {
            showLoading(true);
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            
            const total = IMAGE_DATA.length;
            let loaded = 0;
            
            try {
                // Pre-cargar en tamaños pequeños primero
                const promises = IMAGE_DATA.map((img, index) => {
                    return new Promise((resolve) => {
                        const imgElement = new Image();
                        imgElement.onload = () => {
                            // Guardar en cache
                            imageCache.set(img.id, imgElement.src);
                            loaded++;
                            progressFill.style.width = `${(loaded / total) * 100}%`;
                            resolve();
                        };
                        imgElement.onerror = () => {
                            loaded++;
                            progressFill.style.width = `${(loaded / total) * 100}%`;
                            resolve(); // Ignorar errores
                        };
                        // Usar tamaño muy pequeño para pre-carga rápida
                        imgElement.src = `https://drive.google.com/thumbnail?id=${img.id}&sz=w100`;
                    });
                });
                
                await Promise.allSettled(promises);
                showSuccess(`✓ ${loaded} imágenes pre-cargadas en cache`);
                
            } catch (error) {
                console.error('Error en pre-carga:', error);
            } finally {
                showLoading(false);
                progressBar.style.display = 'none';
            }
        }
        
        // ESTRATEGIA 3: Carga Normal (más lenta, para comparación)
        async function loadNormalGallery() {
            startTime = performance.now();
            showLoading(true);
            clearMessages();
            
            try {
                gallery.innerHTML = '';
                galleryItems = [];
                
                // Cargar imágenes secuencialmente (más lento)
                for (let i = 0; i < IMAGE_DATA.length; i++) {
                    const img = IMAGE_DATA[i];
                    await createNormalGalleryItem(img.id, img.name, i + 1);
                    
                    // Pequeña pausa entre imágenes
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                updateImageCounter();
                
                const endTime = performance.now();
                const loadDuration = ((endTime - startTime) / 1000).toFixed(2);
                loadTime.textContent = `Carga: ${loadDuration}s`;
                
                showSuccess(`✓ ${IMAGE_DATA.length} imágenes cargadas en ${loadDuration} segundos`);
                
                if (IMAGE_DATA.length > 1 && !isAutoPlaying) {
                    startAutoPlay();
                    autoPlayToggle.classList.add('active');
                    autoPlayToggle.innerHTML = '<i class="fas fa-pause"></i> Detener Auto-Desplazamiento';
                    isAutoPlaying = true;
                }
                
            } catch (error) {
                console.error('Error en carga normal:', error);
            } finally {
                showLoading(false);
            }
        }
        
        // Crear elemento de galería normal (más lento)
        async function createNormalGalleryItem(imageId, imageName, number) {
            return new Promise((resolve) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.style.animationDelay = `${number * 0.1}s`;
                
                const imageUrl = `https://drive.google.com/thumbnail?id=${imageId}&sz=w400`;
                const viewUrl = `https://drive.google.com/file/d/${imageId}/view`;
                
                galleryItem.innerHTML = `
                    <a href="${viewUrl}" target="_blank" class="gallery-link" style="display: block; width: 100%; height: 100%;">
                        <img src="${imageUrl}" 
                             alt="${imageName}" 
                             class="gallery-img"
                             onerror="this.src='https://via.placeholder.com/380x280/2a2a3e/3ECF8E?text=Imagen+${number}'">
                        
                        <div class="gallery-overlay">
                            <h3>${imageName}</h3>
                            <p>ID: ${imageId.substring(0, 10)}...</p>
                            <p><small><i class="fas fa-external-link-alt"></i> Haz clic para ver completo</small></p>
                        </div>
                    </a>
                `;
                
                gallery.appendChild(galleryItem);
                galleryItems.push({ id: imageId, element: galleryItem });
                
                // Esperar a que la imagen cargue
                const img = galleryItem.querySelector('img');
                if (img.complete) {
                    resolve();
                } else {
                    img.onload = resolve;
                    img.onerror = resolve;
                }
            });
        }
        
        // Actualizar contador
        function updateImageCounter() {
            imageCounter.textContent = `${galleryItems.length} imágenes`;
        }
        
        // Iniciar auto-desplazamiento
        function startAutoPlay() {
            if (galleryItems.length <= 1) return;
            
            stopAutoPlay();
            
            autoPlayInterval = setInterval(() => {
                if (gallery.scrollLeft + gallery.offsetWidth >= gallery.scrollWidth - 50) {
                    gallery.scrollTo({ left: 0, behavior: 'smooth' });
                } else {
                    gallery.scrollBy({ left: gallery.offsetWidth * 0.85, behavior: 'smooth' });
                }
            }, scrollSpeed);
        }
        
        // Detener auto-desplazamiento
        function stopAutoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
            }
        }
        
        // Mostrar/ocultar loading
        function showLoading(show) {
            loadingIndicator.style.display = show ? 'block' : 'none';
        }
        
        // Mostrar mensaje de éxito
        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 5000);
        }
        
        // Limpiar mensajes
        function clearMessages() {
            successMessage.style.display = 'none';
        }
        
        // Configurar arrastre con mouse
        function setupDragScroll() {
            let isDown = false;
            let startX;
            let scrollLeft;
            
            gallery.addEventListener('mousedown', (e) => {
                isDown = true;
                gallery.classList.add('active');
                startX = e.pageX - gallery.offsetLeft;
                scrollLeft = gallery.scrollLeft;
                stopAutoPlay();
            });
            
            gallery.addEventListener('mouseleave', () => {
                isDown = false;
                gallery.classList.remove('active');
            });
            
            gallery.addEventListener('mouseup', () => {
                isDown = false;
                gallery.classList.remove('active');
                if (isAutoPlaying) {
                    setTimeout(startAutoPlay, 2000);
                }
            });
            
            gallery.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - gallery.offsetLeft;
                const walk = (x - startX) * 2;
                gallery.scrollLeft = scrollLeft - walk;
            });
        }
        
        // Configurar eventos
        function setupEventListeners() {
            loadFastBtn.addEventListener('click', loadFastGallery);
            loadNormalBtn.addEventListener('click', loadNormalGallery);
            preloadBtn.addEventListener('click', preloadAllImages);
            
            prevBtn.addEventListener('click', () => {
                stopAutoPlay();
                gallery.scrollBy({ left: -gallery.offsetWidth * 0.85, behavior: 'smooth' });
                if (isAutoPlaying) setTimeout(startAutoPlay, 5000);
            });
            
            nextBtn.addEventListener('click', () => {
                stopAutoPlay();
                gallery.scrollBy({ left: gallery.offsetWidth * 0.85, behavior: 'smooth' });
                if (isAutoPlaying) setTimeout(startAutoPlay, 5000);
            });
            
            autoPlayToggle.addEventListener('click', () => {
                if (isAutoPlaying) {
                    stopAutoPlay();
                    autoPlayToggle.classList.remove('active');
                    autoPlayToggle.innerHTML = '<i class="fas fa-play"></i> Iniciar Auto-Desplazamiento';
                } else {
                    startAutoPlay();
                    autoPlayToggle.classList.add('active');
                    autoPlayToggle.innerHTML = '<i class="fas fa-pause"></i> Detener Auto-Desplazamiento';
                }
                isAutoPlaying = !isAutoPlaying;
            });
            
            gallery.addEventListener('mouseenter', stopAutoPlay);
            gallery.addEventListener('mouseleave', () => {
                if (isAutoPlaying) startAutoPlay();
            });
        }
        
        // Inicializar
        function init() {
            setupEventListeners();
            setupDragScroll();
            
            // Cargar automáticamente con método rápido
            setTimeout(() => {
                loadFastGallery();
            }, 500);
        }
        
        // Iniciar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
