<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ventana Flotante de Videos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0f0f;
            color: #fff;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Ventana flotante principal */
        .floating-window {
            position: fixed;
            top: 50px;
            left: 50px;
            width: 420px;
            height: 600px;
            background: rgba(15, 15, 15, 0.95);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8),
                        0 0 0 1px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            overflow: hidden;
            z-index: 1000;
            resize: both;
            min-width: 350px;
            min-height: 500px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* Barra de t√≠tulo - para arrastrar */
        .window-header {
            height: 50px;
            background: linear-gradient(90deg, #ff0000, #cc0000);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            cursor: move;
            user-select: none;
            border-radius: 20px 20px 0 0;
            position: relative;
            z-index: 10;
        }

        .window-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.1em;
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s;
        }

        .window-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .close-btn:hover {
            background: #ff4757;
        }

        /* Contenido de la ventana */
        .window-content {
            height: calc(100% - 50px);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Player principal */
        .main-player {
            height: 250px;
            background: #000;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .main-player iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Lista de videos con scroll */
        .video-playlist {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(10, 10, 10, 0.8);
        }

        /* Estilos para scrollbar */
        .video-playlist::-webkit-scrollbar {
            width: 8px;
        }

        .video-playlist::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .video-playlist::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #ff0000, #cc0000);
            border-radius: 4px;
        }

        /* Items de video */
        .playlist-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
        }

        .playlist-item:hover {
            background: rgba(40, 40, 40, 0.9);
            transform: translateX(5px);
            border-color: rgba(255, 0, 0, 0.3);
        }

        .playlist-item.active {
            background: linear-gradient(90deg, rgba(255, 0, 0, 0.2), rgba(204, 0, 0, 0.1));
            border-color: #ff0000;
        }

        .video-thumb {
            width: 80px;
            height: 45px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 15px;
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .video-info {
            flex: 1;
            min-width: 0;
        }

        .video-title {
            font-weight: 500;
            font-size: 0.9em;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: #fff;
        }

        .video-date {
            font-size: 0.75em;
            color: #aaa;
        }

        .new-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(90deg, #ff0000, #ff6b6b);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        /* Controles flotantes */
        .floating-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1001;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff0000, #cc0000);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4);
            transition: all 0.3s;
            position: relative;
        }

        .control-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 15px 40px rgba(255, 0, 0, 0.6);
        }

        .control-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .control-btn:hover::after {
            opacity: 1;
        }

        /* Notificaciones flotantes */
        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(90deg, #00b09b, #96c93d);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 1002;
            max-width: 300px;
            animation: slideInRight 0.5s ease;
        }

        /* Minimizado */
        .window-minimized {
            height: 50px !important;
            width: 300px !important;
            overflow: hidden;
        }

        .window-minimized .window-content {
            display: none;
        }

        /* Animaciones */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Fondo con part√≠culas */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* Instrucciones */
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8em;
            z-index: 1001;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .floating-window {
                width: calc(100vw - 40px);
                height: calc(100vh - 100px);
                top: 20px;
                left: 20px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo con part√≠culas -->
    <div id="particles-js"></div>

    <!-- Ventana flotante principal -->
    <div class="floating-window" id="floatingWindow">
        <div class="window-header" id="windowHeader">
            <div class="window-title">
                <span style="color: #ff0000">‚ñ∂</span>
                <span>Reproductor Flotante</span>
                <span id="video-count" style="font-size: 0.8em; opacity: 0.7;">(0 videos)</span>
            </div>
            <div class="window-controls">
                <button class="window-btn" id="minimizeBtn" title="Minimizar">‚îÄ</button>
                <button class="window-btn close-btn" id="closeBtn" title="Cerrar">√ó</button>
            </div>
        </div>
        
        <div class="window-content" id="windowContent">
            <!-- Reproductor principal -->
            <div class="main-player">
                <iframe id="youtubePlayer"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                </iframe>
            </div>
            
            <!-- Lista de videos -->
            <div class="video-playlist" id="videoPlaylist">
                <div style="text-align: center; padding: 40px; color: #666;">
                    Cargando videos...
                </div>
            </div>
        </div>
    </div>

    <!-- Controles flotantes -->
    <div class="floating-controls">
        <button class="control-btn" id="prevBtn" data-tooltip="Anterior (‚Üê)">
            ‚èÆÔ∏è
        </button>
        <button class="control-btn" id="nextBtn" data-tooltip="Siguiente (‚Üí)">
            ‚è≠Ô∏è
        </button>
        <button class="control-btn" id="refreshBtn" data-tooltip="Actualizar (R)">
            üîÑ
        </button>
        <button class="control-btn" id="pinBtn" data-tooltip="Siempre visible">
            üìå
        </button>
    </div>

    <!-- Notificaci√≥n flotante -->
    <div class="floating-notification" id="notification">
        <span id="notificationText">¬°Nuevo video disponible!</span>
        <button onclick="closeNotification()" style="background:none; border:none; color:white; cursor:pointer;">‚úñ</button>
    </div>

    <!-- Instrucciones -->
    <div class="instructions">
        üí° Arrastra la ventana ‚Ä¢ Doble clic para maximizar/minimizar
    </div>

    <script>
        // Configuraci√≥n
        const CONFIG = {
            channelId: 'UC1T2hmhZojOKVts22YOZvrQ',
            rssUrl: 'https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fwww.youtube.com%2Ffeeds%2Fvideos.xml%3Fchannel_id%3DUC1T2hmhZojOKVts22YOZvrQ',
            updateInterval: 120000, // 2 minutos
            maxVideos: 20
        };

        // Variables globales
        let videos = [];
        let currentVideoIndex = 0;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let isMinimized = false;
        let isPinned = false;
        let lastVideoId = '';

        // Elementos DOM
        const floatingWindow = document.getElementById('floatingWindow');
        const windowHeader = document.getElementById('windowHeader');
        const youtubePlayer = document.getElementById('youtubePlayer');
        const videoPlaylist = document.getElementById('videoPlaylist');
        const videoCount = document.getElementById('videoCount');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');

        // 1. Inicializar sistema de arrastre
        function initDragSystem() {
            windowHeader.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', stopDrag);
            
            // Tambi√©n para touch en m√≥viles
            windowHeader.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                startDrag({
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
            });
            
            document.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                const touch = e.touches[0];
                handleDrag({
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
            });
            
            document.addEventListener('touchend', stopDrag);
            
            // Doble clic para minimizar/maximizar
            windowHeader.addEventListener('dblclick', toggleMinimize);
        }

        function startDrag(e) {
            isDragging = true;
            const rect = floatingWindow.getBoundingClientRect();
            dragOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            floatingWindow.style.transition = 'none';
            document.body.style.cursor = 'grabbing';
            windowHeader.style.cursor = 'grabbing';
        }

        function handleDrag(e) {
            if (!isDragging) return;
            
            let x = e.clientX - dragOffset.x;
            let y = e.clientY - dragOffset.y;
            
            // Mantener dentro de los l√≠mites de la pantalla
            const windowWidth = floatingWindow.offsetWidth;
            const windowHeight = floatingWindow.offsetHeight;
            
            x = Math.max(0, Math.min(x, window.innerWidth - windowWidth));
            y = Math.max(0, Math.min(y, window.innerHeight - windowHeight));
            
            floatingWindow.style.left = x + 'px';
            floatingWindow.style.top = y + 'px';
        }

        function stopDrag() {
            if (!isDragging) return;
            isDragging = false;
            floatingWindow.style.transition = 'all 0.3s ease';
            document.body.style.cursor = 'default';
            windowHeader.style.cursor = 'move';
            
            // Guardar posici√≥n
            localStorage.setItem('windowPosition', JSON.stringify({
                x: parseInt(floatingWindow.style.left),
                y: parseInt(floatingWindow.style.top)
            }));
        }

        // 2. Cargar videos
        async function loadVideos() {
            try {
                showLoading(true);
                
                const response = await fetch(CONFIG.rssUrl);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    videos = data.items.slice(0, CONFIG.maxVideos).map(item => {
                        // Extraer video ID de la URL
                        const videoId = item.link.split('v=')[1]?.split('&')[0] || 
                                      item.link.split('/').pop();
                        
                        return {
                            id: videoId,
                            title: item.title,
                            thumbnail: item.thumbnail,
                            published: item.pubDate,
                            description: item.description,
                            isNew: isVideoNew(item.pubDate)
                        };
                    });
                    
                    updatePlaylistUI();
                    updateVideoCount();
                    
                    // Verificar nuevo video
                    if (videos.length > 0) {
                        const latestVideo = videos[0];
                        
                        if (lastVideoId && latestVideo.id !== lastVideoId) {
                            showNotification(`üé¨ Nuevo video: "${latestVideo.title}"`);
                            
                            // Si est√° en autoplay, cambiar al nuevo
                            if (currentVideoIndex === 0) {
                                playVideo(0);
                            }
                        }
                        
                        lastVideoId = latestVideo.id;
                        
                        // Si no hay video actual, reproducir el primero
                        if (currentVideoIndex === -1) {
                            playVideo(0);
                        }
                    }
                }
                
                showLoading(false);
                
            } catch (error) {
                console.error('Error cargando videos:', error);
                videoPlaylist.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #ff6b6b;">
                        <p>Error cargando videos</p>
                        <button onclick="loadVideos()" style="margin-top: 10px; padding: 8px 16px; background: #ff0000; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Reintentar
                        </button>
                    </div>
                `;
            }
        }

        // 3. Actualizar lista de videos
        function updatePlaylistUI() {
            if (videos.length === 0) {
                videoPlaylist.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No hay videos disponibles</div>';
                return;
            }
            
            videoPlaylist.innerHTML = videos.map((video, index) => `
                <div class="playlist-item ${index === currentVideoIndex ? 'active' : ''}" 
                     onclick="playVideo(${index})"
                     data-video-id="${video.id}">
                    <img src="${video.thumbnail}" 
                         alt="${video.title}" 
                         class="video-thumb"
                         loading="lazy"
                         onerror="this.src='https://via.placeholder.com/80x45/333/fff?text=‚ñ∂'">
                    <div class="video-info">
                        <div class="video-title">
                            ${video.title}
                            ${video.isNew ? '<span class="new-badge">NUEVO</span>' : ''}
                        </div>
                        <div class="video-date">
                            ${formatDate(video.published)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 4. Reproducir video
        function playVideo(index) {
            if (index < 0 || index >= videos.length) return;
            
            currentVideoIndex = index;
            const video = videos[index];
            
            // Actualizar iframe
            youtubePlayer.src = `https://www.youtube.com/embed/${video.id}?autoplay=1&rel=0&modestbranding=1&controls=1`;
            
            // Actualizar UI
            updatePlaylistUI();
            
            // Scroll al video activo
            const activeItem = document.querySelector('.playlist-item.active');
            if (activeItem) {
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // Guardar √∫ltimo video visto
            localStorage.setItem('lastVideoIndex', index);
        }

        // 5. Funciones de navegaci√≥n
        function playNextVideo() {
            const nextIndex = (currentVideoIndex + 1) % videos.length;
            playVideo(nextIndex);
        }

        function playPrevVideo() {
            const prevIndex = (currentVideoIndex - 1 + videos.length) % videos.length;
            playVideo(prevIndex);
        }

        // 6. Controles de ventana
        function toggleMinimize() {
            isMinimized = !isMinimized;
            
            if (isMinimized) {
                floatingWindow.classList.add('window-minimized');
                document.getElementById('minimizeBtn').textContent = '‚ñ°';
                document.getElementById('minimizeBtn').title = 'Maximizar';
            } else {
                floatingWindow.classList.remove('window-minimized');
                document.getElementById('minimizeBtn').textContent = '‚îÄ';
                document.getElementById('minimizeBtn').title = 'Minimizar';
            }
        }

        function togglePin() {
            isPinned = !isPinned;
            const pinBtn = document.getElementById('pinBtn');
            
            if (isPinned) {
                floatingWindow.style.zIndex = '9999';
                pinBtn.style.background = 'linear-gradient(135deg, #00b09b, #96c93d)';
                pinBtn.textContent = 'üìç';
                pinBtn.setAttribute('data-tooltip', 'Desfijar ventana');
            } else {
                floatingWindow.style.zIndex = '1000';
                pinBtn.style.background = 'linear-gradient(135deg, #ff0000, #cc0000)';
                pinBtn.textContent = 'üìå';
                pinBtn.setAttribute('data-tooltip', 'Siempre visible');
            }
        }

        // 7. Funciones auxiliares
        function isVideoNew(publishedDate) {
            const published = new Date(publishedDate);
            const now = new Date();
            const daysDiff = (now - published) / (1000 * 60 * 60 * 24);
            return daysDiff < 2; // Menos de 2 d√≠as = nuevo
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return 'Hoy';
            } else if (diffDays === 1) {
                return 'Ayer';
            } else if (diffDays < 7) {
                return `Hace ${diffDays} d√≠as`;
            } else {
                return date.toLocaleDateString('es-ES', {
                    day: 'numeric',
                    month: 'short'
                });
            }
        }

        function updateVideoCount() {
            videoCount.textContent = `(${videos.length} videos)`;
        }

        function showLoading(show) {
            if (show) {
                videoPlaylist.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="width: 40px; height: 40px; border: 3px solid #333; border-top-color: #ff0000; border-radius: 50%; margin: 0 auto 15px; animation: spin 1s linear infinite;"></div>
                        <div style="color: #666;">Cargando videos...</div>
                    </div>
                `;
            }
        }

        function showNotification(message) {
            notificationText.textContent = message;
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        function closeNotification() {
            notification.style.display = 'none';
        }

        // 8. Event listeners
        document.getElementById('minimizeBtn').addEventListener('click', toggleMinimize);
        document.getElementById('closeBtn').addEventListener('click', () => {
            if (confirm('¬øCerrar el reproductor?')) {
                floatingWindow.style.display = 'none';
            }
        });
        document.getElementById('refreshBtn').addEventListener('click', loadVideos);
        document.getElementById('prevBtn').addEventListener('click', playPrevVideo);
        document.getElementById('nextBtn').addEventListener('click', playNextVideo);
        document.getElementById('pinBtn').addEventListener('click', togglePin);

        // 9. Atajos de teclado
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key) {
                case 'ArrowRight':
                    playNextVideo();
                    break;
                case 'ArrowLeft':
                    playPrevVideo();
                    break;
                case 'r':
                case 'R':
                    if (e.ctrlKey) break;
                    loadVideos();
                    break;
                case 'm':
                case 'M':
                    toggleMinimize();
                    break;
                case 'Escape':
                    toggleMinimize();
                    break;
            }
        });

        // 10. Inicializar
        function init() {
            // Cargar posici√≥n guardada
            const savedPosition = localStorage.getItem('windowPosition');
            if (savedPosition) {
                const pos = JSON.parse(savedPosition);
                floatingWindow.style.left = pos.x + 'px';
                floatingWindow.style.top = pos.y + 'px';
            }
            
            // Cargar √∫ltimo video visto
            const lastIndex = localStorage.getItem('lastVideoIndex');
            if (lastIndex) {
                currentVideoIndex = parseInt(lastIndex);
            }
            
            // Inicializar sistemas
            initDragSystem();
            loadVideos();
            
            // Actualizar peri√≥dicamente
            setInterval(loadVideos, CONFIG.updateInterval);
            
            // Inicializar part√≠culas (opcional)
            initParticles();
        }

        // 11. Sistema de part√≠culas (opcional)
        function initParticles() {
            if (typeof particlesJS !== 'undefined') {
                particlesJS('particles-js', {
                    particles: {
                        number: { value: 30, density: { enable: true, value_area: 800 } },
                        color: { value: "#ff0000" },
                        shape: { type: "circle" },
                        opacity: { value: 0.3, random: true },
                        size: { value: 3, random: true },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: "#ff0000",
                            opacity: 0.1,
                            width: 1
                        },
                        move: {
                            enable: true,
                            speed: 1,
                            direction: "none",
                            random: true,
                            straight: false,
                            out_mode: "out",
                            bounce: false
                        }
                    },
                    interactivity: {
                        detect_on: "canvas",
                        events: {
                            onhover: { enable: true, mode: "repulse" },
                            onclick: { enable: true, mode: "push" }
                        }
                    },
                    retina_detect: true
                });
            }
        }

        // 12. Cargar script de part√≠culas si no est√° cargado
        if (typeof particlesJS === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js';
            script.onload = initParticles;
            document.head.appendChild(script);
        }

        // Iniciar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
