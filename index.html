<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slider de Videos de YouTube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slider-transition {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .dot-active {
            background-color: #EF4444 !important;
            transform: scale(1.2);
            transition: all 0.3s ease;
        }
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .video-item:hover .video-overlay {
            opacity: 1;
        }
        .play-icon {
            width: 60px;
            height: 60px;
            background: #EF4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .video-item:hover .play-icon {
            transform: scale(1);
        }
        .new-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #EF4444;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
        }
        .video-title {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-10 fade-in">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">
                üé¨ Videos del Canal
            </h1>
            <p class="text-gray-600 mb-4">
                Slider autom√°tico que se actualiza con nuevos videos
            </p>
            <div class="flex items-center justify-center gap-4 text-sm text-gray-500">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <span id="total-videos">Cargando...</span> videos
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span>Actualizaci√≥n autom√°tica</span>
                </div>
            </div>
        </div>

        <!-- Main Slider Container -->
        <div class="flex flex-col items-center fade-in">
            <div class="w-full max-w-4xl overflow-hidden relative rounded-2xl shadow-2xl">
                <!-- Video Player Container -->
                <div class="relative bg-black rounded-t-2xl">
                    <div id="video-player-container" class="relative" style="padding-bottom: 56.25%;">
                        <iframe 
                            id="youtube-player"
                            class="absolute top-0 left-0 w-full h-full rounded-t-2xl"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen>
                        </iframe>
                        <div id="player-loading" class="absolute inset-0 flex items-center justify-center bg-gray-900 rounded-t-2xl">
                            <div class="text-white text-center">
                                <div class="w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                                <p>Cargando video...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video Info -->
                    <div id="video-info" class="p-4 bg-gradient-to-t from-black/80 to-transparent text-white">
                        <h3 id="current-video-title" class="text-xl font-bold mb-1">Selecciona un video</h3>
                        <div class="flex items-center justify-between text-sm text-gray-300">
                            <span id="current-video-date">--</span>
                            <span id="current-video-index" class="bg-red-500 px-3 py-1 rounded-full">0/0</span>
                        </div>
                    </div>
                </div>

                <!-- Thumbnails Slider -->
                <div class="bg-white p-4 rounded-b-2xl">
                    <div class="relative">
                        <!-- Navigation Buttons -->
                        <button id="prev-btn" class="absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-4 z-10 w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-100 transition-colors">
                            ‚Üê
                        </button>
                        <button id="next-btn" class="absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-4 z-10 w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-100 transition-colors">
                            ‚Üí
                        </button>
                        
                        <!-- Thumbnails Container -->
                        <div class="overflow-hidden px-2">
                            <div class="flex slider-transition gap-3 py-2" id="thumbnails-slider">
                                <!-- Thumbnails will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dot Indicators -->
            <div class="flex items-center mt-6 space-x-3" id="dot-indicators">
                <!-- Dots will be generated here -->
            </div>

            <!-- Controls -->
            <div class="flex items-center gap-4 mt-6">
                <button id="auto-play-toggle" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                    ‚èØÔ∏è Auto-slide: <span id="auto-play-status">ON</span>
                </button>
                <button id="refresh-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors flex items-center gap-2">
                    üîÑ Actualizar
                </button>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="mt-8 text-center text-sm text-gray-500">
            <p>üì° Conectado a: <span class="font-mono text-gray-700">UC1T2hmhZojOKVts22YOZvrQ</span></p>
            <p id="last-update" class="mt-1">√öltima actualizaci√≥n: --:--:--</p>
        </div>
    </div>

    <script>
        // Configuraci√≥n
        const CONFIG = {
            channelId: 'UC1T2hmhZojOKVts22YOZvrQ',
            maxVideos: 20,
            autoSlideInterval: 5000, // 5 segundos
            updateCheckInterval: 60000, // 1 minuto
            slidesPerView: 5 // Cu√°ntas miniaturas mostrar
        };

        // Estado
        let videos = [];
        let currentSlide = 0;
        let autoSlideEnabled = true;
        let autoSlideTimer;
        let updateTimer;
        let lastVideoCount = 0;

        // Elementos DOM
        const elements = {
            slider: document.getElementById('thumbnails-slider'),
            dotsContainer: document.getElementById('dot-indicators'),
            player: document.getElementById('youtube-player'),
            playerLoading: document.getElementById('player-loading'),
            videoTitle: document.getElementById('current-video-title'),
            videoDate: document.getElementById('current-video-date'),
            videoIndex: document.getElementById('current-video-index'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            autoPlayToggle: document.getElementById('auto-play-toggle'),
            autoPlayStatus: document.getElementById('auto-play-status'),
            refreshBtn: document.getElementById('refresh-btn'),
            totalVideos: document.getElementById('total-videos'),
            lastUpdate: document.getElementById('last-update')
        };

        // 1. Inicializar
        async function init() {
            await loadVideos();
            setupEventListeners();
            startAutoSlide();
            startUpdateChecker();
        }

        // 2. Cargar videos desde RSS
        async function loadVideos() {
            try {
                showLoading(true);
                
                const proxyUrl = 'https://api.allorigins.win/get?url=';
                const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${CONFIG.channelId}`;
                const encodedUrl = encodeURIComponent(rssUrl);
                
                const response = await fetch(proxyUrl + encodedUrl);
                const data = await response.json();
                
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data.contents, "text/xml");
                const entries = xmlDoc.getElementsByTagName('entry');
                
                videos = [];
                for (let i = 0; i < Math.min(entries.length, CONFIG.maxVideos); i++) {
                    const entry = entries[i];
                    const videoId = entry.getElementsByTagName('yt:videoId')[0].textContent;
                    const title = entry.getElementsByTagName('title')[0].textContent;
                    const published = entry.getElementsByTagName('published')[0].textContent;
                    
                    videos.push({
                        id: videoId,
                        title: title,
                        publishedAt: new Date(published),
                        thumbnail: `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`,
                        isNew: isVideoNew(published),
                        daysAgo: getDaysAgo(published)
                    });
                }
                
                // Verificar si hay nuevos videos
                if (videos.length > 0 && videos[0].id !== lastVideoCount) {
                    if (lastVideoCount > 0) {
                        showNewVideoNotification(videos[0].title);
                    }
                    lastVideoCount = videos[0].id;
                }
                
                renderThumbnails();
                updateDots();
                updateStats();
                
                // Si es la primera carga, mostrar el primer video
                if (videos.length > 0 && currentSlide === 0) {
                    playVideo(0);
                }
                
                showLoading(false);
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('Error cargando videos:', error);
                showError('Error al cargar videos. Reintentando...');
                setTimeout(loadVideos, 3000);
            }
        }

        // 3. Renderizar miniaturas
        function renderThumbnails() {
            elements.slider.innerHTML = '';
            elements.dotsContainer.innerHTML = '';
            
            videos.forEach((video, index) => {
                // Crear miniatura
                const thumbnail = document.createElement('div');
                thumbnail.className = `flex-shrink-0 w-48 rounded-xl overflow-hidden cursor-pointer transition-all duration-300 hover:scale-105 video-item ${
                    index === currentSlide ? 'ring-2 ring-red-500 scale-105' : ''
                }`;
                thumbnail.style.flex = `0 0 ${100 / CONFIG.slidesPerView}%`;
                thumbnail.style.maxWidth = `${100 / CONFIG.slidesPerView}%`;
                
                thumbnail.innerHTML = `
                    <div class="relative">
                        <img src="${video.thumbnail}" 
                             alt="${video.title}" 
                             class="w-full h-32 object-cover"
                             loading="lazy"
                             onerror="this.src='https://via.placeholder.com/192x108/EF4444/FFFFFF?text=Video'">
                        ${video.isNew ? '<span class="new-badge">NUEVO</span>' : ''}
                        <div class="video-overlay">
                            <div class="play-icon">‚ñ∂</div>
                        </div>
                    </div>
                    <div class="p-3 bg-white">
                        <h4 class="video-title text-sm font-medium text-gray-900 mb-1">${video.title}</h4>
                        <div class="flex justify-between items-center text-xs text-gray-500">
                            <span>${video.daysAgo}</span>
                            <span>#${index + 1}</span>
                        </div>
                    </div>
                `;
                
                thumbnail.addEventListener('click', () => playVideo(index));
                elements.slider.appendChild(thumbnail);
                
                // Crear dot
                const dot = document.createElement('span');
                dot.className = `w-3 h-3 rounded-full cursor-pointer transition-all ${
                    index === currentSlide ? 'dot-active bg-red-500' : 'bg-gray-300 hover:bg-gray-400'
                }`;
                dot.addEventListener('click', () => goToSlide(index));
                elements.dotsContainer.appendChild(dot);
            });
            
            updateSliderPosition();
        }

        // 4. Navegaci√≥n del slider
        function goToSlide(index) {
            if (index < 0 || index >= videos.length) return;
            
            currentSlide = index;
            updateSliderPosition();
            updateDots();
            playVideo(index);
            
            // Reiniciar auto-slide
            if (autoSlideEnabled) {
                restartAutoSlide();
            }
        }

        function updateSliderPosition() {
            const slideWidth = 100 / CONFIG.slidesPerView;
            const translateX = currentSlide * slideWidth;
            elements.slider.style.transform = `translateX(-${translateX}%)`;
            
            // Actualizar miniaturas activas
            document.querySelectorAll('.video-item').forEach((item, idx) => {
                item.classList.toggle('ring-2', idx === currentSlide);
                item.classList.toggle('ring-red-500', idx === currentSlide);
                item.classList.toggle('scale-105', idx === currentSlide);
            });
        }

        function updateDots() {
            document.querySelectorAll('#dot-indicators span').forEach((dot, index) => {
                dot.classList.toggle('dot-active', index === currentSlide);
                dot.classList.toggle('bg-red-500', index === currentSlide);
                dot.classList.toggle('bg-gray-300', !(index === currentSlide));
            });
        }

        function nextSlide() {
            const nextIndex = (currentSlide + 1) % videos.length;
            goToSlide(nextIndex);
        }

        function prevSlide() {
            const prevIndex = (currentSlide - 1 + videos.length) % videos.length;
            goToSlide(prevIndex);
        }

        // 5. Reproducir video
        function playVideo(index) {
            if (!videos[index]) return;
            
            const video = videos[index];
            
            // Mostrar loading
            elements.playerLoading.style.display = 'flex';
            elements.player.style.opacity = '0';
            
            // Actualizar iframe
            elements.player.src = `https://www.youtube.com/embed/${video.id}?autoplay=1&rel=0&modestbranding=1`;
            
            // Actualizar informaci√≥n
            elements.videoTitle.textContent = video.title;
            elements.videoDate.textContent = formatFullDate(video.publishedAt);
            elements.videoIndex.textContent = `${index + 1}/${videos.length}`;
            
            // Cuando el video cargue
            elements.player.onload = () => {
                elements.playerLoading.style.display = 'none';
                elements.player.style.opacity = '1';
            };
        }

        // 6. Auto-slide
        function startAutoSlide() {
            if (autoSlideEnabled) {
                autoSlideTimer = setInterval(nextSlide, CONFIG.autoSlideInterval);
            }
        }

        function toggleAutoSlide() {
            autoSlideEnabled = !autoSlideEnabled;
            elements.autoPlayStatus.textContent = autoSlideEnabled ? 'ON' : 'OFF';
            
            if (autoSlideEnabled) {
                startAutoSlide();
                showNotification('Auto-slide activado');
            } else {
                clearInterval(autoSlideTimer);
                showNotification('Auto-slide desactivado');
            }
        }

        function restartAutoSlide() {
            clearInterval(autoSlideTimer);
            if (autoSlideEnabled) {
                startAutoSlide();
            }
        }

        // 7. Verificaci√≥n de actualizaciones
        function startUpdateChecker() {
            updateTimer = setInterval(async () => {
                try {
                    const proxyUrl = 'https://api.allorigins.win/get?url=';
                    const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${CONFIG.channelId}`;
                    const encodedUrl = encodeURIComponent(rssUrl);
                    
                    const response = await fetch(proxyUrl + encodedUrl);
                    const data = await response.json();
                    
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(data.contents, "text/xml");
                    const entries = xmlDoc.getElementsByTagName('entry');
                    
                    if (entries.length > 0) {
                        const latestVideoId = entries[0].getElementsByTagName('yt:videoId')[0].textContent;
                        
                        if (videos.length === 0 || videos[0].id !== latestVideoId) {
                            console.log('Nuevo video detectado, actualizando...');
                            await loadVideos();
                        }
                    }
                } catch (error) {
                    console.error('Error verificando actualizaciones:', error);
                }
            }, CONFIG.updateCheckInterval);
        }

        // 8. Event Listeners
        function setupEventListeners() {
            elements.prevBtn.addEventListener('click', prevSlide);
            elements.nextBtn.addEventListener('click', nextSlide);
            elements.autoPlayToggle.addEventListener('click', toggleAutoSlide);
            elements.refreshBtn.addEventListener('click', loadVideos);
            
            // Teclado
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowLeft':
                        prevSlide();
                        break;
                    case 'ArrowRight':
                        nextSlide();
                        break;
                    case ' ':
                        e.preventDefault();
                        toggleAutoSlide();
                        break;
                }
            });
            
            // Swipe en m√≥vil
            let touchStartX = 0;
            let touchEndX = 0;
            
            elements.slider.parentElement.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            elements.slider.parentElement.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        nextSlide(); // Swipe izquierda
                    } else {
                        prevSlide(); // Swipe derecha
                    }
                }
            }
        }

        // 9. Funciones auxiliares
        function isVideoNew(publishedDate) {
            const published = new Date(publishedDate);
            const now = new Date();
            const daysDiff = (now - published) / (1000 * 60 * 60 * 24);
            return daysDiff < 7;
        }

        function getDaysAgo(publishedDate) {
            const published = new Date(publishedDate);
            const now = new Date();
            const diffMs = now - published;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Hoy';
            if (diffDays === 1) return 'Ayer';
            if (diffDays < 7) return `Hace ${diffDays} d√≠as`;
            if (diffDays < 30) return `Hace ${Math.floor(diffDays/7)} semanas`;
            return `Hace ${Math.floor(diffDays/30)} meses`;
        }

        function formatFullDate(date) {
            return date.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function updateStats() {
            elements.totalVideos.textContent = videos.length;
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            elements.lastUpdate.textContent = `√öltima actualizaci√≥n: ${timeStr}`;
        }

        function showNotification(message) {
            // Crear notificaci√≥n temporal
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg z-50 fade-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showNewVideoNotification(title) {
            showNotification(`üé¨ ¬°Nuevo video! "${title.substring(0, 50)}..."`);
            
            // Notificaci√≥n del navegador
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("üé• Nuevo Video en YouTube", {
                    body: title,
                    icon: videos[0]?.thumbnail
                });
            }
        }

        function showLoading(show) {
            if (show) {
                elements.slider.innerHTML = `
                    <div class="flex w-full items-center justify-center py-12">
                        <div class="text-center">
                            <div class="w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p class="text-gray-500">Cargando videos...</p>
                        </div>
                    </div>
                `;
            }
        }

        function showError(message) {
            elements.slider.innerHTML = `
                <div class="flex w-full items-center justify-center py-12">
                    <div class="text-center text-red-500">
                        <p class="text-lg font-medium mb-2">‚ö†Ô∏è Error</p>
                        <p class="mb-4">${message}</p>
                        <button onclick="loadVideos()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            Reintentar
                        </button>
                    </div>
                </div>
            `;
        }

        // 10. Inicializar notificaciones
        if ("Notification" in window && Notification.permission === "default") {
            Notification.requestPermission();
        }

        // 11. Iniciar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
